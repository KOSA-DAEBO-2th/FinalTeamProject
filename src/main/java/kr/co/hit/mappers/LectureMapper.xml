<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.hit.dao.LectureDao">

	<select id="getLectureListCount" resultType="int">
		SELECT COUNT(*)
		FROM BOARD B
		INNER JOIN
		LECTURE L
		ON B.B_NO =
		L.B_NO

		WHERE
		CAT_NO = 5
		<choose>
			<when test='param2.equals("a")'>

				AND B_TITLE LIKE CONCAT('%', #{param1},'%')

			</when>

			<otherwise>

				AND B_TITLE LIKE CONCAT('%', #{param1},'%') AND
				LECTURE_TOPIC_NAME LIKE
				CONCAT('%',#{param2},'%')

			</otherwise>

		</choose>
	</select>

	<select id="selectLecturePage"
		resultType="kr.co.hit.dto.LectureDto">
		SELECT B.B_NO, B.B_TITLE,
		B.B_CONTENT, B.B_WRITE_DATE,
		B.B_VIEW,
		B.B_REPLY,
		B.B_RECOMMEND,
		B.MEMBER_NO, B.CAT_NO,
		L.LECTURE_TAGS,
		L.LECTURE_TOPIC_NAME,
		L.LECTURE_STATE,
		L.LECTURE_FIELD,
		F.FILE_URL
		FROM BOARD B
		INNER JOIN
		LECTURE L
		ON B.B_NO =
		L.B_NO
		LEFT OUTER
		JOIN (SELECT * FROM FILE WHERE THUMBNAIL = 0 GROUP BY B_NO) F
		ON B.B_NO
		= F.B_NO

		WHERE CAT_NO =
		5 AND B_TITLE LIKE CONCAT('%',#{param1},'%')
		ORDER BY B.B_NO DESC LIMIT
		#{param2},#{param3};


	</select>

	<select id="selectLectureList"
		resultType="kr.co.hit.dto.LectureDto">
		SELECT B.B_NO, B.B_TITLE, B.B_CONTENT, B.B_WRITE_DATE,
		B.B_VIEW,
		B.B_REPLY,
		B.B_RECOMMEND,
		B.MEMBER_NO, B.CAT_NO,
		L.LECTURE_TAGS,
		L.LECTURE_TOPIC_NAME,
		L.LECTURE_STATE, L.LECTURE_FIELD
		FROM BOARD B
		INNER JOIN
		LECTURE L
		ON B.B_NO =
		L.B_NO

		WHERE CAT_NO =
		5;
	</select>

	<select id="selectLectureTopicList"
		resultType="kr.co.hit.dto.LectureDto">
		SELECT B.B_NO,
		B.B_TITLE,
		B.B_CONTENT, B.B_WRITE_DATE,
		B.B_VIEW,
		B.B_REPLY,
		B.B_RECOMMEND,
		B.MEMBER_NO, B.CAT_NO,
		L.LECTURE_TAGS,
		L.LECTURE_TOPIC_NAME,
		L.LECTURE_STATE,
		L.LECTURE_FIELD
		FROM BOARD B
		INNER JOIN
		LECTURE L
		ON B.B_NO =
		L.B_NO

		WHERE
		CAT_NO = 5 AND
		B_TITLE LIKE CONCAT('%',
		#{param1},'%') AND
		LECTURE_TOPIC_NAME =
		#{param2} LIMIT #{param3},
		#{param4};

	</select>

	<update id="increaseView">
		UPDATE BOARD SET b_view = b_view+1 WHERE b_no =
		#{boardIdx};

	</update>
	
		<select id="selectLectureRead"
		resultType="kr.co.hit.dto.LectureDto">
		SELECT B.B_TITLE, B.B_CONTENT, B.B_WRITE_DATE,
		B.B_VIEW,
		B.B_REPLY, B.B_RECOMMEND,
		B.MEMBER_NO, B.CAT_NO, L.*

		FROM BOARD B
		INNER
		JOIN
		LECTURE L
		ON B.B_NO =
		L.B_NO

		WHERE B.B_NO =
		#{boardIdx};

	</select>
	
	

</mapper>